<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puzzle Box Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="noise-overlay"></div>
    <div class="gradient-orb orb-1"></div>
    <div class="gradient-orb orb-2"></div>
    <div class="gradient-orb orb-3"></div>
    
    <main class="container">
        <header class="hero">
            <div class="logo">
                <svg viewBox="0 0 100 100" class="puzzle-icon">
                    <rect x="10" y="10" width="35" height="35" rx="4" class="piece piece-1"/>
                    <rect x="55" y="10" width="35" height="35" rx="4" class="piece piece-2"/>
                    <rect x="10" y="55" width="35" height="35" rx="4" class="piece piece-3"/>
                    <rect x="55" y="55" width="35" height="35" rx="4" class="piece piece-4"/>
                </svg>
            </div>
            <h1>Puzzle Box</h1>
            <p class="tagline">Generate customized puzzle boxes with random mazes for 3D printing</p>
            
            <div class="presets-section">
                <span class="presets-label">Quick Presets:</span>
                <button type="button" class="preset-btn" onclick="applyPreset('simple')">Simple</button>
                <button type="button" class="preset-btn" onclick="applyPreset('challenging')">Challenging</button>
                <button type="button" class="preset-btn" onclick="applyPreset('extreme')">Extreme</button>
                <button type="button" class="preset-btn" onclick="applyPreset('gift')">Gift Box</button>
            </div>
            
            <div class="share-section">
                <div class="share-input-group">
                    <input type="text" id="shareId" placeholder="Paste Share ID to restore settings..." class="share-input">
                    <button type="button" class="share-btn" onclick="importShareId()">Import</button>
                </div>
                <p class="share-hint">Use a Share ID to regenerate the exact same puzzle</p>
            </div>
        </header>

        <form id="puzzleForm" class="generator-form">
            <div class="form-grid">
                <!-- Hidden inputs for always-on features -->
                <input type="hidden" name="watermark" value="1">
                <input type="hidden" name="format" value="makerworld" id="format-makerworld">

                <!-- Parts Section -->
                <section class="form-section">
                    <h2>
                        <span class="section-number">01</span>
                        Parts
                    </h2>
                    <p class="section-desc">Define how many interlocking pieces make up your puzzle box. More parts = harder puzzle.</p>
                    <div class="input-group">
                        <div class="input-field">
                            <label for="m">Total Parts</label>
                            <input type="text" id="m" name="m" value="2">
                            <span class="input-hint">Number of nesting cylinders (2-6). The innermost holds content, outer parts form the puzzle.</span>
                        </div>
                        <div class="input-field">
                            <label for="n">Part to Make</label>
                            <input type="text" id="n" name="n" value="0">
                            <span class="input-hint">0 = generate all parts. Use 1-6 to generate a specific part for separate printing.</span>
                        </div>
                    </div>
                </section>

                <!-- Box Size - PROMINENT -->
                <section class="form-section highlight">
                    <h2>
                        <span class="section-number">02</span>
                        Box Size
                    </h2>
                    <p class="section-desc">Configure overall box dimensions. <strong>Taller height = more maze rows = harder puzzle!</strong></p>
                    <div class="input-group">
                        <div class="input-field">
                            <label for="h">Height</label>
                            <div class="input-with-unit">
                                <input type="number" id="h" name="h" step="1" value="50">
                                <span class="unit">mm</span>
                            </div>
                            <span class="input-hint">Increase for longer, harder maze</span>
                        </div>
                        <div class="input-field">
                            <label for="c">Diameter</label>
                            <div class="input-with-unit">
                                <input type="number" id="c" name="c" step="0.1" value="30">
                                <span class="unit">mm</span>
                            </div>
                            <span class="input-hint">Internal storage width</span>
                        </div>
                    </div>
                    <div class="maze-rows-indicator">
                        <span class="maze-rows-icon">üß©</span>
                        <span class="maze-rows-text">Estimated maze rows: <strong id="mazeRowsCount">10</strong></span>
                        <span class="maze-rows-hint">(based on height and maze spacing)</span>
                    </div>
                </section>

                <!-- Core Storage -->
                <section class="form-section">
                    <h2>
                        <span class="section-number">03</span>
                        Core Storage
                    </h2>
                    <p class="section-desc">Configure the internal storage space for hiding content (gift, message, etc).</p>
                    <div class="input-group">
                        <div class="input-field">
                            <label for="C">Removal Gap</label>
                            <div class="input-with-unit">
                                <input type="number" id="C" name="C" step="0.1">
                                <span class="unit">mm</span>
                            </div>
                            <span class="input-hint">Extra gap to easily remove content</span>
                        </div>
                    </div>
                    <div class="toggle-group compact">
                        <label class="toggle-option">
                            <input type="checkbox" name="q" id="opt-solid">
                            <span class="toggle-label">
                                <span class="toggle-title">Solid Core</span>
                                <span class="toggle-desc">Content space is in part 2 instead of part 1</span>
                            </span>
                        </label>
                    </div>
                </section>

                <!-- Clearances -->
                <section class="form-section">
                    <h2>
                        <span class="section-number">04</span>
                        Clearances
                    </h2>
                    <p class="section-desc">Fine-tune tolerances for your printer. Adjust if parts are too tight or too loose.</p>
                    <div class="input-group">
                        <div class="input-field">
                            <label for="Z">Base Gap (Z)</label>
                            <div class="input-with-unit">
                                <input type="number" id="Z" name="Z" step="0.01" value="0.4">
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-field">
                            <label for="g">General X/Y</label>
                            <div class="input-with-unit">
                                <input type="number" id="g" name="g" step="0.01" value="0.4">
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-field">
                            <label for="y">Nub Radius Extra</label>
                            <div class="input-with-unit">
                                <input type="number" id="y" name="y" step="0.01" value="0.1">
                                <span class="unit">mm</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Text Customization -->
                <section class="form-section wide">
                    <h2>
                        <span class="section-number">05</span>
                        Text & Branding
                    </h2>
                    <p class="section-desc">Add personalized text to your puzzle box - initials, names, or messages on the ends and sides.</p>
                    <div class="input-group">
                        <div class="input-field">
                            <label for="E">End Text</label>
                            <input type="text" id="E" name="E">
                            <span class="input-hint">Initials on end (use \ for line breaks)</span>
                        </div>
                        <div class="input-field">
                            <label for="I">Inside End Text</label>
                            <input type="text" id="I" name="I">
                            <span class="input-hint">Initials inside end</span>
                        </div>
                        <div class="input-field">
                            <label for="S">Side Text</label>
                            <input type="text" id="S" name="S">
                            <span class="input-hint">Text on sides</span>
                        </div>
                    </div>
                    <div class="input-group">
                        <div class="input-field">
                            <label for="F">Side Font</label>
                            <select id="F" name="F">
                                <option value="Liberation Sans" selected>Liberation Sans</option>
                                <option value="Liberation Sans:style=Bold">Liberation Sans Bold</option>
                                <option value="Liberation Mono">Liberation Mono</option>
                                <option value="Liberation Serif">Liberation Serif</option>
                                <option value="Arial">Arial</option>
                                <option value="Arial:style=Bold">Arial Bold</option>
                                <option value="Helvetica">Helvetica</option>
                                <option value="Helvetica:style=Bold">Helvetica Bold</option>
                                <option value="Times New Roman">Times New Roman</option>
                                <option value="Courier New">Courier New</option>
                                <option value="Georgia">Georgia</option>
                                <option value="Verdana">Verdana</option>
                                <option value="Impact">Impact</option>
                            </select>
                        </div>
                        <div class="input-field">
                            <label for="e">End/Inside Font</label>
                            <select id="e" name="e">
                                <option value="Liberation Sans" selected>Liberation Sans</option>
                                <option value="Liberation Sans:style=Bold">Liberation Sans Bold</option>
                                <option value="Liberation Mono">Liberation Mono</option>
                                <option value="Liberation Serif">Liberation Serif</option>
                                <option value="Arial">Arial</option>
                                <option value="Arial:style=Bold">Arial Bold</option>
                                <option value="Helvetica">Helvetica</option>
                                <option value="Helvetica:style=Bold">Helvetica Bold</option>
                                <option value="Times New Roman">Times New Roman</option>
                                <option value="Courier New">Courier New</option>
                                <option value="Georgia">Georgia</option>
                                <option value="Verdana">Verdana</option>
                                <option value="Impact">Impact</option>
                            </select>
                        </div>
                        <div class="input-field">
                            <label for="D">Text Depth</label>
                            <div class="input-with-unit">
                                <input type="number" id="D" name="D" step="0.1" value="0.5">
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-field">
                            <label for="T">Side Text Scale</label>
                            <div class="input-with-unit">
                                <input type="number" id="T" name="T" step="1" value="100">
                                <span class="unit">%</span>
                            </div>
                            <span class="input-hint">Scale side text if too long</span>
                        </div>
                        <div class="input-field">
                            <label for="U">End Text Scale</label>
                            <div class="input-with-unit">
                                <input type="number" id="U" name="U" step="1" value="100">
                                <span class="unit">%</span>
                            </div>
                            <span class="input-hint">Scale end initials</span>
                        </div>
                        <div class="input-field">
                            <label for="J">Inside Text Scale</label>
                            <div class="input-with-unit">
                                <input type="number" id="J" name="J" step="1" value="100">
                                <span class="unit">%</span>
                            </div>
                            <span class="input-hint">Scale inside text</span>
                        </div>
                    </div>
                    <div class="toggle-group compact">
                        <label class="toggle-option">
                            <input type="checkbox" name="d" id="opt-diagonal" checked>
                            <span class="toggle-label">
                                <span class="toggle-title">Diagonal Edges</span>
                                <span class="toggle-desc">Text has diagonal edges</span>
                            </span>
                        </label>
                        <label class="toggle-option">
                            <input type="checkbox" name="O" id="opt-outset">
                            <span class="toggle-label">
                                <span class="toggle-title">Outset Text</span>
                                <span class="toggle-desc">Text on sides is outset not embossed</span>
                            </span>
                        </label>
                    </div>
                </section>

                <!-- Maze Configuration -->
                <section class="form-section">
                    <h2>
                        <span class="section-number">06</span>
                        Maze Settings
                    </h2>
                    <p class="section-desc">Configure the maze that locks the puzzle. Higher complexity = more challenging to solve.</p>
                    <div class="input-group">
                        <div class="input-field">
                            <label for="t">Thickness</label>
                            <div class="input-with-unit">
                                <input type="number" id="t" name="t" step="0.1" value="2">
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-field">
                            <label for="z">Spacing</label>
                            <div class="input-with-unit">
                                <input type="number" id="z" name="z" step="0.1" value="3">
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-field">
                            <label for="M">Top Margin</label>
                            <div class="input-with-unit">
                                <input type="number" id="M" name="M" step="0.1" value="1">
                                <span class="unit">mm</span>
                            </div>
                        </div>
                    </div>
                    <div class="input-group">
                        <div class="input-field slider-field">
                            <label for="X">Complexity</label>
                            <div class="slider-container">
                                <input type="range" id="X" name="X" min="-10" max="10" value="5">
                                <output for="X" class="slider-value">5</output>
                            </div>
                            <span class="input-hint">-10 (simple) to 10 (complex)</span>
                        </div>
                    </div>
                    <div class="toggle-group compact">
                        <label class="toggle-option">
                            <input type="checkbox" name="i" id="opt-inside">
                            <span class="toggle-label">
                                <span class="toggle-title">Inside Maze</span>
                                <span class="toggle-desc">Maze on inside (hard mode)</span>
                            </span>
                        </label>
                        <label class="toggle-option">
                            <input type="checkbox" name="f" id="opt-alternating">
                            <span class="toggle-label">
                                <span class="toggle-title">Alternating</span>
                                <span class="toggle-desc">Inside/outside maze pattern</span>
                            </span>
                        </label>
                        <label class="toggle-option">
                            <input type="checkbox" name="V" id="opt-symmetric">
                            <span class="toggle-label">
                                <span class="toggle-title">Symmetric Cut</span>
                                <span class="toggle-desc">Symmetric maze cut</span>
                            </span>
                        </label>
                        <label class="toggle-option">
                            <input type="checkbox" name="Q" id="opt-test">
                            <span class="toggle-label">
                                <span class="toggle-title">Test Pattern</span>
                                <span class="toggle-desc">Use test pattern instead of maze</span>
                            </span>
                        </label>
                    </div>
                </section>

                <!-- Mechanical Features -->
                <section class="form-section">
                    <h2>
                        <span class="section-number">07</span>
                        Mechanical
                    </h2>
                    <p class="section-desc">Set the locking mechanism. Nubs and helix create the tactile feel when twisting the box open.</p>
                    <div class="input-group">
                        <div class="input-field">
                            <label for="N">Nubs</label>
                            <input type="text" id="N" name="N" value="2">
                        </div>
                        <div class="input-field">
                            <label for="H">Helix</label>
                            <input type="text" id="H" name="H" value="2">
                            <span class="input-hint">0 for non-helical</span>
                        </div>
                    </div>
                    <div class="input-group">
                        <div class="input-field">
                            <label for="p">Park Ridge</label>
                            <div class="input-with-unit">
                                <input type="number" id="p" name="p" step="0.1" value="0.7">
                                <span class="unit">mm</span>
                            </div>
                            <span class="input-hint">Click-closed thickness</span>
                        </div>
                    </div>
                    <div class="toggle-group compact">
                        <label class="toggle-option">
                            <input type="checkbox" name="v" id="opt-vertical">
                            <span class="toggle-label">
                                <span class="toggle-title">Vertical Park</span>
                                <span class="toggle-desc">Park vertically</span>
                            </span>
                        </label>
                    </div>
                </section>

                <!-- Structure -->
                <section class="form-section">
                    <h2>
                        <span class="section-number">08</span>
                        Structure
                    </h2>
                    <p class="section-desc">Define wall and base dimensions. Thicker walls are stronger but use more material.</p>
                    <div class="input-group">
                        <div class="input-field">
                            <label for="w">Wall Thickness</label>
                            <div class="input-with-unit">
                                <input type="number" id="w" name="w" step="0.1" value="1.2">
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-field">
                            <label for="b">Base Height</label>
                            <div class="input-with-unit">
                                <input type="number" id="b" name="b" step="0.1" value="10">
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-field">
                            <label for="B">Base Thickness</label>
                            <div class="input-with-unit">
                                <input type="number" id="B" name="B" step="0.1" value="1.6">
                                <span class="unit">mm</span>
                            </div>
                        </div>
                    </div>
                    <div class="toggle-group compact">
                        <label class="toggle-option">
                            <input type="checkbox" name="W" id="opt-fullwidth">
                            <span class="toggle-label">
                                <span class="toggle-title">Full Width Base</span>
                                <span class="toggle-desc">Inside base full width</span>
                            </span>
                        </label>
                    </div>
                </section>

                <!-- Appearance -->
                <section class="form-section">
                    <h2>
                        <span class="section-number">09</span>
                        Appearance
                    </h2>
                    <p class="section-desc">Customize the outer look. Choose polygon sides (0 for round) and edge rounding.</p>
                    <div class="input-group">
                        <div class="input-field">
                            <label for="s">Outer Sides</label>
                            <input type="text" id="s" name="s" value="7">
                            <span class="input-hint">0 = round</span>
                        </div>
                        <div class="input-field">
                            <label for="r">Rounding</label>
                            <div class="input-with-unit">
                                <input type="number" id="r" name="r" step="0.1" value="2">
                                <span class="unit">mm</span>
                            </div>
                            <span class="input-hint">Outer rounding on ends</span>
                        </div>
                        <div class="input-field">
                            <label for="G">Grip Depth</label>
                            <div class="input-with-unit">
                                <input type="number" id="G" name="G" step="0.1" value="1.5">
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-field">
                            <label for="L">Logo Depth</label>
                            <div class="input-with-unit">
                                <input type="number" id="L" name="L" step="0.1" value="0.6">
                                <span class="unit">mm</span>
                            </div>
                        </div>
                    </div>
                </section>

            </div>

            <!-- Generate Button -->
            <div class="generate-section">
                <button type="submit" class="generate-btn primary" id="downloadBtn">
                    <span class="btn-icon">üåê</span>
                    <span class="btn-text">
                        <span class="btn-title">Generate Code</span>
                        <span class="btn-desc">Get code for MakerWorld</span>
                    </span>
                </button>
            </div>
        </form>

    </main>

    <!-- Polyhedron Code Modal -->
    <div id="codeModal" class="modal" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Polyhedron Code for MakerWorld</h3>
                <button type="button" class="modal-close" onclick="closeCodeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-instructions">
                    Copy each part separately and paste into 
                    <a href="https://makerworld.com/en/makerlab/parametricModelMaker?pageType=generator" target="_blank">MakerWorld Parametric Model Maker</a>.
                    Each part is a complete, valid OpenSCAD file.
                </p>
                
                <!-- Parts Grid Overview -->
                <div id="partsOverview" class="parts-overview"></div>
                
                <!-- Share ID -->
                <div id="shareIdSection"></div>
                
                <!-- Selected Part Code -->
                <div id="selectedPartCode" class="selected-part-code"></div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>


